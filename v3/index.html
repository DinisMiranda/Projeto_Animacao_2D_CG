<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cidade Sustentável – v3</title>
  <link rel="stylesheet" href="./style.css">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 0; background: #0e1116; color: #e6e8ee; }
    header { padding: 12px 16px; background: #161a22; border-bottom: 1px solid #1f2530; display:flex; align-items:center; gap:16px; }
    header .sp { flex:1; }
    main { display: grid; place-items: center; min-height: calc(100vh - 60px); padding: 16px; }
    canvas { width: min(96vw, 1100px); height: auto; max-height: 70vh; background: linear-gradient(#7cc7ff, #cfeaff); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05); }
    label { color:#a3adc2; }
  </style>
</head>
<body>
  <header>
    <h2 style="margin:0">Cidade Sustentável – v3 (Transit + Fábrica)</h2>
    <span class="sp"></span>
    <label><input id="chkSolar" type="checkbox"> Solar</label>
    <label><input id="chkRecycling" type="checkbox"> Reciclagem</label>
    <label><input id="chkTransit" type="checkbox"> Transporte</label>
  </header>
  <main>
    <canvas id="c" width="960" height="540"></canvas>
  </main>
  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    let t = 0; let traffic = 0;
    const state = { solar:false, recycling:false, transit:false };
    chkSolar.addEventListener('change', e=> state.solar = e.target.checked);
    chkRecycling.addEventListener('change', e=> state.recycling = e.target.checked);
    chkTransit.addEventListener('change', e=> state.transit = e.target.checked);
    const clouds=[0,180,360,540,720];
    function circle(x,y,r){ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.closePath();ctx.fill();}
    function h2r(h){h=h.replace('#','');if(h.length===3)h=h.split('').map(c=>c+c).join('');const n=parseInt(h,16);return{r:(n>>16)&255,g:(n>>8)&255,b:n&255}}
    function lerpColor(a,b,t){const ca=h2r(a),cb=h2r(b);const r=Math.round(ca.r+(cb.r-ca.r)*t),g=Math.round(ca.g+(cb.g-ca.g)*t),bl=Math.round(ca.b+(cb.b-ca.b)*t);return `rgb(${r},${g},${bl})`;}
    function score(){return (state.solar?0.35:0)+(state.recycling?0.35:0)+(state.transit?0.3:0)}
    function drawFactory(){const baseX=770, baseY=420; ctx.fillStyle='#555b6e'; ctx.fillRect(baseX,baseY-120,140,120); ctx.fillStyle='#4a5164'; ctx.fillRect(baseX+100,baseY-160,26,160); ctx.fillRect(baseX+118,baseY-140,22,140); drawSmoke(baseX+111,baseY-160);}
    function drawSmoke(x,y){const s=score(); const intensity=1-s; const puffs=Math.round(6+intensity*16); for(let i=0;i<puffs;i++){const tt=(t*0.0009+i*0.12)%1; const px=x+Math.sin(tt*Math.PI*2)*(12+intensity*18); const py=y-tt*(90+intensity*120); const size=6+(1-tt)*(18+intensity*22); const alpha=0.18+(1-tt)*(0.35+intensity*0.25); ctx.fillStyle=`rgba(${Math.round(120+40*intensity)},${Math.round(120+40*intensity)},${Math.round(120+40*intensity)},${alpha})`; circle(px,py,size);} }
    function frame(){
      t+=16; traffic=(traffic+2+(1-score())*2)%(canvas.width+200);
      const s=score();
      const top=lerpColor('#78b7ff','#9be7ff',s*0.6), bottom=lerpColor('#c6e0ff','#e9f7ff',s*0.6);
      const grd=ctx.createLinearGradient(0,0,0,canvas.height); grd.addColorStop(0,top); grd.addColorStop(1,bottom);
      ctx.fillStyle=grd; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = state.solar ? '#ffd166':'#ffb703'; circle(820 + Math.sin(t*0.0003)*20, 90, 26);
      ctx.fillStyle='#fff'; ctx.globalAlpha=0.75 - s*0.4; for(let i=0;i<5;i++){const x=((clouds[i]+t*0.03)%1200)-100; const y=60+i*22; circle(x,y,22); circle(x+28,y-8,18); circle(x+54,y,24);} ctx.globalAlpha=1;
      ctx.fillStyle=lerpColor('#7a8a99','#7acb92',s); ctx.fillRect(0,420,canvas.width,120);
      ctx.fillStyle='#444c5a'; ctx.fillRect(0,440,canvas.width,60);
      ctx.strokeStyle='#cfd7e6'; ctx.setLineDash([18,14]); ctx.lineWidth=3; ctx.beginPath(); ctx.moveTo(-(t/8%32),470); ctx.lineTo(canvas.width,470); ctx.stroke(); ctx.setLineDash([]);
      const buildings=[{x:60,w:120,h:180},{x:210,w:90,h:220},{x:320,w:150,h:200},{x:500,w:110,h:230},{x:650,w:140,h:190}];
      buildings.forEach((b)=>{ ctx.fillStyle=lerpColor('#445066','#5a7aa0',s*0.6); ctx.fillRect(b.x,420-b.h,b.w,b.h); if(state.solar){ ctx.fillStyle='#2d6a4f'; ctx.fillRect(b.x+8,420-b.h-10,b.w-16,6); ctx.fillStyle='#74c69d'; for(let i=0;i<Math.floor((b.w-16)/18);i++) ctx.fillRect(b.x+10+i*18,420-b.h-9,14,4);} });
      if(state.recycling){ [{x:140,c:'#2d6cdf'},{x:180,c:'#f5cb5c'},{x:220,c:'#3cb371'}].forEach(b=>{ ctx.fillStyle=b.c; ctx.fillRect(b.x,408,22,26); ctx.fillStyle='#0c111a'; ctx.fillRect(b.x+4,404,14,6);}); }
      // cars
      const carCount=7-Math.round(s*4); for(let i=0;i<carCount;i++){const x=(i*180+traffic)%(canvas.width+200)-100; ctx.fillStyle=i%2?'#4dabf7':'#ff6b6b'; ctx.fillRect(x,480-16,42,16); ctx.fillRect(x+6,480-24,26,10); ctx.fillStyle='#263241'; circle(x+10,480,6); circle(x+34,480,6);} 
      // bus
      if(state.transit){ const busX=(canvas.width+200-(traffic*0.7%(canvas.width+200))); ctx.fillStyle='#ffd166'; ctx.fillRect(busX-120,458-22,120,22); ctx.fillRect(busX-120+18,458-34,84,14); ctx.fillStyle='#142034'; for(let i=0;i<5;i++) ctx.fillRect(busX-120+22+i*16,458-30,12,9); ctx.fillStyle='#1a2633'; circle(busX-120+20,458,8); circle(busX-120+92,458,8);} 
      drawFactory();
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  </script>
</body>
</html>

